(()=>{"use strict";const e=window.wp.i18n,t=window.wp.hooks,i=window.wp.compose,r=window.wp.blockEditor,a=window.wp.components;(0,t.addFilter)("blocks.registerBlockType","block-accessibility-checks/add-image-attribute",(function(e){return"core/image"!==e.name||(e.attributes=Object.assign(e.attributes,{isDecorative:{type:"boolean",default:!1}})),e}));var c=(0,i.createHigherOrderComponent)((function(t){return function(i){if("core/image"!==i.name)return React.createElement(t,i);var c=i.attributes,n=i.setAttributes,s=c.isDecorative;return React.createElement(React.Fragment,null,React.createElement(r.InspectorControls,null,React.createElement(a.PanelBody,{title:(0,e.__)("Accessibility Settings","block-accessibility-checks"),initialOpen:!0},React.createElement(a.ToggleControl,{label:(0,e.__)("Please confirm this image is decorative","block-accessibility-checks"),checked:s,onChange:function(e){return n({isDecorative:e})}}))),React.createElement(t,i))}}),"addImageInspectorControls");(0,t.addFilter)("editor.BlockEdit","block-accessibility-checks/add-inspector-control",c);const n=window.wp.plugins,s=window.wp.data;function o(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function d(e){return e.flatMap((function(e){var t=_.map((function(t){return t(e)}));return e.innerBlocks&&e.innerBlocks.length>0?[].concat(o(t),o(d(e.innerBlocks))):t}))}function u(){return d((0,s.useSelect)((function(e){return e("core/block-editor").getBlocks()}),[])).filter((function(e){return!e.isValid}))}const b=window.wp.element;var m=BlockAccessibilityChecks.blockChecksOptions.coreButtonBlockCheck;function k(t){if("core/button"===t.name&&!t.attributes.url&&!t.attributes.text.originalHTML){var i={isValid:!0,message:"",clientId:t.clientId,mode:m};switch(m){case"error":i.isValid=!1,i.message=(0,e.__)("Error: Buttons must have text and a link","block-accessibility-checks");break;case"warning":i.isValid=!1,i.message=(0,e.__)("Warning: Buttons must have text and a link","block-accessibility-checks");break;default:i.isValid=!0}return i}return{isValid:!0,mode:"none"}}var g=BlockAccessibilityChecks.blockChecksOptions.coreHeadingBlockCheck;function h(t){if("core/heading"===t.name&&1===t.attributes.level){var i={isValid:!0,message:"",clientId:t.clientId,mode:g};switch(g){case"error":i.isValid=!1,i.message=(0,e.__)("Error: Level 1 headings should only be used for page titles","block-accessibility-checks");break;case"warning":i.isValid=!1,i.message=(0,e.__)("Warning: Level 1 headings should only be used for page titles","block-accessibility-checks");break;default:i.isValid=!0}return i}return{isValid:!0,mode:"none"}}var f=BlockAccessibilityChecks.blockChecksOptions.coreImageBlockCheck;function y(t){if("core/image"===t.name&&!t.attributes.alt&&!t.attributes.isDecorative){var i={isValid:!0,message:"",clientId:t.clientId,mode:f};switch(f){case"error":i.isValid=!1,i.message=(0,e.__)("Error: Images are required to have alternative text","block-accessibility-checks");break;case"warning":i.isValid=!1,i.message=(0,e.__)("Warning: Images are required to have alternative text","block-accessibility-checks");break;default:i.isValid=!0}return i}return{isValid:!0,mode:"none"}}var v=BlockAccessibilityChecks.blockChecksOptions.coreTableBlockCheck;function w(t){if("core/table"===t.name&&0!==t.attributes.body.length&&0===t.attributes.head.length){var i={isValid:!0,message:"",clientId:t.clientId,mode:v};switch(v){case"error":i.isValid=!1,i.message=(0,e.__)("Error: Tables are required to have a header row","block-accessibility-checks");break;case"warning":i.isValid=!1,i.message=(0,e.__)("Warning: Tables are required to have a header row","block-accessibility-checks");break;default:i.isValid=!0}return i}return{isValid:!0,mode:"none"}}var p=(0,i.createHigherOrderComponent)((function(t){return function(i){var c=i.name,n=i.attributes,s=i.clientId,o={isValid:!0,mode:"none",message:""};switch(c){case"core/button":o=k({name:c,attributes:n,clientId:s});break;case"core/heading":o=h({name:c,attributes:n,clientId:s});break;case"core/image":o=y({name:c,attributes:n,clientId:s});break;case"core/table":o=w({name:c,attributes:n,clientId:s});break;default:o={isValid:!0,mode:"none",message:""}}var l="";return o.message?l=o.message:"error"===o.mode?l=(0,e.__)("Accessibility Error: This block does not meet accessibility standards.","block-accessibility-checks"):"warning"===o.mode&&(l=(0,e.__)("Accessibility Warning: This block may have accessibility issues.","block-accessibility-checks")),React.createElement(React.Fragment,null,"none"!==o.mode&&React.createElement("div",{className:"error"===o.mode?"a11y-block-error":"a11y-block-warning"},React.createElement(t,i)),"none"===o.mode&&React.createElement(t,i),"none"!==o.mode&&React.createElement(r.InspectorControls,null,React.createElement(a.PanelBody,{title:(0,e.__)("Accessibility Check","block-accessibility-checks"),initialOpen:!0},React.createElement(a.PanelRow,null,React.createElement("p",{className:"error"===o.mode?"a11y-error-msg":"a11y-warning-msg"},l)))))}}),"withErrorHandling");(0,t.addFilter)("editor.BlockEdit","block-accessibility-checks/with-error-handling",p);var _=[k,h,y,w];(0,n.registerPlugin)("block-validation",{render:function(){var e=u(),t=(0,s.useDispatch)("core/editor"),i=t.lockPostSaving,r=t.unlockPostSaving,a=t.lockPostAutosaving,c=t.unlockPostAutosaving,n=t.disablePublishSidebar,o=t.enablePublishSidebar;return(0,b.useEffect)((function(){e.some((function(e){return"error"===e.mode}))?(i(),a(),n()):(r(),c(),o())}),[e,n,o,a,i,c,r]),null}})})();